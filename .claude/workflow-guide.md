# DataClean AI 开发工作规范 - 快速参考

## 四阶段工作流

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   诊断阶段   │ →  │   测试阶段   │ →  │   修复阶段   │ →  │   验证阶段   │
│  (任务#2)   │    │  (任务#3)   │    │  (任务#4)   │    │  (任务#5)   │
│ 15分钟内完成 │    │ 修改前完成  │    │ 一次性修改  │    │ 提交前完成  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 16项预提交检查清单

### 诊断阶段 (任务#2)
- [ ] 1. 存储检查 - localStorage/app data
- [ ] 2. 日志检查 - debug.log/console logs
- [ ] 3. 复现确认 - 干净环境100%复现
- [ ] 4. 根因明确 - 一句话说明原因
- [ ] 5. 方案完整 - 列出所有修改点

### 测试阶段 (任务#3)
- [ ] 6. 测试先行 - 测试能复现问题
- [ ] 7. 编译通过 - `npx tsc --noEmit`
- [ ] 8. 单元测试 - `npm test`
- [ ] 9. 集成测试 - `npm run test:integration`

### 修复阶段 (任务#4)
- [ ] 10. 代码修改 - 所有文件已修改
- [ ] 11. 修改说明 - 原因已文档化
- [ ] 12. 影响评估 - 副作用已评估

### 验证阶段 (任务#5)
- [ ] 13. E2E 测试 - Playwright截图通过
- [ ] 14. 环境清理 - localStorage/temp清理
- [ ] 15. 截图留存 - UI变更已截图
- [ ] 16. 一句话总结 - 修改内容已说明

## 三原则

### 1. 诊断优先原则
**铁律：不诊断清楚，一行代码都不改**

### 2. 测试先行原则
**规则：任何修改前，测试必须能复现问题**

### 3. 完整修复原则
**规则：诊断清楚后，一次性修改所有相关代码**

## 诊断输出模板

```
【问题】一句话描述现象
【根因】一句话说明原因
【方案】
1. 修改文件 A：原因 + 改成什么样
2. 修改文件 B：原因 + 改成什么样
【时间】预计 X 分钟
【风险】可能的副作用
```

## 时间承诺

| 任务类型 | 承诺时间 | 是否需要用户参与 |
|---------|---------|----------------|
| Bug 修复（已知原因） | 30 分钟内 | ❌ 不需要 |
| Bug 修复（需诊断） | 1 小时内 | ❌ 不需要 |
| 新功能（有明确需求） | 2-4 小时 | ❌ 不需要 |
| UI 样式调整 | 30 分钟 + 截图 | ✅ 看一眼（30秒） |
| 性能优化 | 2 小时 + 数据 | ✅ 确认效果 |

## 效果评估指标

| 指标 | 目标 | 测量方式 |
|-----|------|---------|
| 往返次数 | 每次需求 ≤ 2 次交互 | 记录对话轮数 |
| 解决时间 | 简单 30min / 复杂 2h | 记录时间戳 |
| 用户参与度 | 仅必要的人工确认 | 统计需用户操作次数 |
| 回归率 | 修复后不再复发 | 追踪问题复发 |
| 诊断准确率 | 第一次诊断就找准根因 | 统计诊断次数 |

## 自动化 vs 人工确认

### 能自动化的（全包）
- TypeScript 编译检查
- 单元测试
- 集成测试
- E2E 测试
- 截图对比

### 需人工确认的（最小化）
- 视觉确认 - UI 布局/样式变更（30s看图）
- 手感确认 - 动画/交互新增（1分钟体验）
- 业务确认 - 复杂数据结果存疑（用户提供样本）

## 执行任务命令

```bash
# 查看当前任务列表
claude task list

# 获取任务详情
claude task get <task-id>

# 更新任务状态
claude task update <task-id> --status in_progress
claude task update <task-id> --status completed
```

## 项目特殊要求

1. **Hidden Sheets Policy**: 默认排除隐藏的 sheet
2. **No Mocking Policy**: 默认实现真实逻辑，禁止模拟/占位代码
3. **Preserving Working Parameters**: 非必要不改原有生效参数
